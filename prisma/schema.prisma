generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BtwTarief {
  HOOG_21
  LAAG_9
  NUL_0
  VRIJGESTELD
  VERLEGD
}

enum InvoiceEmailStatus {
  CONCEPT
  VERZONDEN
  BETAALD
  HERINNERING
}

enum QuotationStatus {
  CONCEPT
  VERZONDEN
  GEACCEPTEERD
  AFGEWEZEN
}

enum Eenheid {
  UUR
  STUK
  PROJECT
  LICENTIE
  SERVICE
  KM
}

enum UserRole {
  USER
  ADMIN
}

model User {
  id             String           @id @default(uuid())
  email          String           @unique
  passwordHash   String
  naam           String?
  role           UserRole         @default(USER)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  companyProfile CompanyProfile?
  clients        Client[]
  invoices       Invoice[]
  quotations     Quotation[]
  expenses       Expense[]
  timeEntries    TimeEntry[]
}

model CompanyProfile {
  id           String   @id @default(uuid())
  userId       String   @unique
  companyName  String
  address      String
  postalCode   String
  city         String
  kvkNumber    String
  btwNumber    String
  iban         String
  bankName     String
  paymentTerms String
  logoUrl      String?
  korEnabled   Boolean  @default(false)
  user         User     @relation(fields: [userId], references: [id])
}

model Client {
  id         String   @id @default(uuid())
  userId     String
  name       String
  address    String
  postalCode String
  city       String
  email      String
  kvkNumber  String?
  btwId      String?
  user       User     @relation(fields: [userId], references: [id])
  invoices   Invoice[]
  quotations Quotation[]
}

model Invoice {
  id           String             @id @default(uuid())
  userId       String
  clientId     String
  invoiceNum   String             @unique
  date         DateTime
  dueDate      DateTime
  emailStatus  InvoiceEmailStatus @default(CONCEPT)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  user         User               @relation(fields: [userId], references: [id])
  client       Client             @relation(fields: [clientId], references: [id])
  lines        InvoiceLine[]
}

model InvoiceLine {
  id          String   @id @default(uuid())
  invoiceId   String
  description String
  quantity    Decimal  @db.Decimal(10, 2)
  price       Decimal  @db.Decimal(10, 2)
  amount      Decimal  @db.Decimal(12, 2)
  vatRate     BtwTarief
  unit        Eenheid
  invoice     Invoice  @relation(fields: [invoiceId], references: [id])
}

model Quotation {
  id          String          @id @default(uuid())
  userId      String
  clientId    String
  quoteNum    String          @unique
  date        DateTime
  validUntil  DateTime
  status      QuotationStatus @default(CONCEPT)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  user        User            @relation(fields: [userId], references: [id])
  client      Client          @relation(fields: [clientId], references: [id])
  lines       QuotationLine[]
}

model QuotationLine {
  id          String   @id @default(uuid())
  quotationId String
  description String
  quantity    Decimal  @db.Decimal(10, 2)
  price       Decimal  @db.Decimal(10, 2)
  amount      Decimal  @db.Decimal(12, 2)
  vatRate     BtwTarief
  unit        Eenheid
  quotation   Quotation @relation(fields: [quotationId], references: [id])
}

model Expense {
  id          String    @id @default(uuid())
  userId      String
  category    String
  description String
  amountExcl  Decimal   @db.Decimal(12, 2)
  vatRate     BtwTarief
  date        DateTime
  receiptUrl  String?
  createdAt   DateTime  @default(now())
  user        User      @relation(fields: [userId], references: [id])
}

model TimeEntry {
  id          String   @id @default(uuid())
  userId      String
  description String
  date        DateTime
  hours       Decimal  @db.Decimal(5, 2)
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])
}
